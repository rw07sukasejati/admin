<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login Kas RT</title>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
body{
  font-family:system-ui,sans-serif;
  background:linear-gradient(135deg,#2563eb,#1e40af);
  min-height:100vh;
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:18px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  display:none;
}
h2{text-align:center;margin:0 0 10px}
.subtitle{text-align:center;font-size:13px;color:#6b7280;margin-bottom:20px}
label{font-weight:600;margin-top:14px;display:block}
input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #d1d5db;
}
button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
}
.btn-primary{background:#2563eb;color:#fff}
.btn-logout{background:#ef4444;color:#fff}
.saldo{
  background:#ecfeff;
  border:1px solid #67e8f9;
  padding:14px;
  border-radius:12px;
  text-align:center;
  margin-bottom:16px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="card" id="loginCard">
  <h2>Login Sistem Kas</h2>
  <div class="subtitle">Akses terbatas bendahara</div>

  <label>Username</label>
  <input id="loginUser">

  <label>Password</label>
  <input id="loginPass" type="password">

  <button class="btn-primary" onclick="doLogin()">LOGIN</button>
</div>

<!-- APP -->
<div class="card" id="appCard">
  <h2>Form Transaksi Kas</h2>

  <div class="saldo">
    <div>Saldo Kas Saat Ini</div>
    <b id="saldoText">Loading...</b>
  </div>

  <label>Jenis</label>
  <select id="jenis">
    <option value="">-- pilih --</option>
    <option>Pemasukan</option>
    <option>Pengeluaran</option>
  </select>

  <label>Kategori</label>
  <select id="kode">
    <option value="">-- pilih --</option>
    <option value="WST">WST - Sampah</option>
    <option value="ATK">ATK</option>
    <option value="KSM">Konsumsi</option>
  </select>

  <label>Keterangan</label>
  <input id="keterangan">

  <label>PIC</label>
  <input id="pic">

  <label>Nominal</label>
  <input id="nominal" type="number">

  <button class="btn-primary" onclick="submitForm()">SUBMIT</button>
  <button class="btn-logout" onclick="logout()">LOGOUT</button>
</div>

<script>
/* ===== KONFIGURASI ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbwyr51XI--mCJcwRTJ0fHW6LFBg12_s10H_qMqmhak4vibiI6eUUzI5M0qMHA8_AlrWvQ/exec";

/* ===== SESSION ===== */
function cekLogin(){
  if(sessionStorage.getItem("login_ok")==="1"){
    loginCard.style.display="none";
    appCard.style.display="block";
    loadSaldo();
  }else{
    loginCard.style.display="block";
    appCard.style.display="none";
  }
}

function doLogin(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"login",
      user:loginUser.value,
      pass:loginPass.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="ok"){
      sessionStorage.setItem("login_ok","1");
      Swal.fire("Berhasil","Login sukses","success")
        .then(cekLogin);
    }else{
      Swal.fire("Gagal","Username / Password salah","error");
    }
  });
}

function logout(){
  sessionStorage.removeItem("login_ok");
  cekLogin();
}

/* ===== SALDO ===== */
function loadSaldo(){
  fetch(API_URL+"?action=getSaldo")
    .then(r=>r.json())
    .then(res=>{
      saldoText.innerText="Rp "+res.saldo.toLocaleString("id-ID");
    });
}

/* ===== SUBMIT ===== */
function submitForm(){
  const data={
    action:"submit",
    jenis:jenis.value,
    kode:kode.value,
    keterangan:keterangan.value,
    pic:pic.value,
    nominal:Number(nominal.value)
  };

  if(!data.jenis||!data.kode||!data.nominal){
    Swal.fire("Data belum lengkap","","warning");
    return;
  }

  Swal.fire({title:"Menyimpan...",allowOutsideClick:false,didOpen:()=>Swal.showLoading()});

  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify(data)
  })
  .then(r=>r.json())
  .then(()=>{
    Swal.fire("Berhasil","Transaksi tersimpan","success");
    jenis.value=kode.value=keterangan.value=pic.value=nominal.value="";
    loadSaldo();
  });
}

window.onload=cekLogin;
</script>

</body>
</html>
